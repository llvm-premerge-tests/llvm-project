; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; RUN: opt < %s -passes=instcombine -S | FileCheck %s
declare void @nothrow() nounwind
declare i32 @__gxx_personality_v0(...)
declare i32 @_except_handler3(...)

; Verify that unwindabort is removed when a call is nounwind.
define void @test() personality ptr @__gxx_personality_v0 {
; CHECK-LABEL: @test(
; CHECK-NEXT:    call void @nothrow()
; CHECK-NEXT:    ret void
;
  call unwindabort void @nothrow()
  ret void
}

; ...except we can't remove unwindabort of a nounwind function, if the
; personality handles async exceptions.
define void @testSEH() personality ptr @_except_handler3 {
; CHECK-LABEL: @testSEH(
; CHECK-NEXT:    call unwindabort void @nothrow()
; CHECK-NEXT:    ret void
;
  call unwindabort void @nothrow()
  ret void
}

