# RUN: llc -march=mips64 -o - %s -run-pass=register-coalescer -verify-coalescing | FileCheck %s

---
name:            f
tracksRegLiveness: true
body:             |
  bb.0:
    %0:gpr32 = ADDiu $zero, 0
    %1:gpr32 = COPY %0
    %2:gpr32 = ADDiu %1, 1
    J %bb.1, implicit-def dead $at

  bb.1:
    BEQ %2, $zero, %bb.2, implicit-def $at

  bb.2:
    %3:gpr32 = COPY %0
    %0:gpr32 = COPY %3
    BEQ undef %4:gpr32, $zero, %bb.2, implicit-def $at

  bb.3:

...

# We should not hoist the
#
#  %1:gpr32 = COPY %0
#
# into bb.1 since %1 is used in the BEQ.

# CHECK-LABEL: bb.1:
# CHECK-NOT:      COPY
# CHECK:          BEQ

# CHECK-LABEL: bb.2:
