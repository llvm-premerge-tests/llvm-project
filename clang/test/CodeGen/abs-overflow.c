// NOTE: Assertions have been autogenerated by utils/update_cc_test_checks.py UTC_ARGS: --version 2
// RUN: %clang_cc1 -triple x86_64-unknown-unknown -emit-llvm %s -o - -fwrapv -fsanitize=builtin | FileCheck %s --check-prefix=WRAPV
// RUN: %clang_cc1 -triple x86_64-unknown-unknown -emit-llvm %s -o - -ftrapv | FileCheck %s --check-prefix=TRAPV
// RUN: %clang_cc1 -triple x86_64-unknown-unknown -emit-llvm %s -o - -fsanitize=signed-integer-overflow | FileCheck %s --check-prefix=CATCH_UB
// RUN: %clang_cc1 -triple x86_64-unknown-unknown -emit-llvm %s -o - -fsanitize=builtin | FileCheck %s --check-prefix=CATCH_UB
// TODO: Support -ftrapv-handler


int absi(int x) {
// WRAPV:   call i32 @llvm.abs.i32(i32 [[X:%.*]], i1 false)
//
// TRAPV:       [[NEG:%.*]] = call { i32, i1 } @llvm.ssub.with.overflow.i32(i32 0, i32 [[X:%.*]])
// TRAPV:       [[NEGV:%.*]] = extractvalue { i32, i1 } [[NEG]], 0
// TRAPV:       [[OFL:%.*]] = extractvalue { i32, i1 } [[NEG]], 1
// TRAPV:       [[NOFL:%.*]] = xor i1 [[OFL]], true
// TRAPV:       br i1 [[NOFL]], label %[[CONT:.*]], label %[[TRAP:.*]], !nosanitize !2
// TRAPV:       [[TRAP]]:
// TRAPV-NEXT:    llvm.ubsantrap
// TRAPV-NEXT:    unreachable
// TRAPV:       [[CONT]]:
// TRAPV-NEXT:    [[ABSCOND:%.*]] = icmp slt i32 [[X]], 0
// TRAPV-NEXT:    select i1 [[ABSCOND]], i32 [[NEGV]], i32 [[X]]
//
// CATCH_UB:       [[NEG:%.*]] = call { i32, i1 } @llvm.ssub.with.overflow.i32(i32 0, i32 [[X:%.*]])
// CATCH_UB:       [[NEGV:%.*]] = extractvalue { i32, i1 } [[NEG]], 0
// CATCH_UB:       [[OFL:%.*]] = extractvalue { i32, i1 } [[NEG]], 1
// CATCH_UB:       [[NOFL:%.*]] = xor i1 [[OFL]], true
// CATCH_UB:       [[NOFL_TMP:%.*]] = and i1 [[NOFL]], [[NOFL]]
// CATCH_UB:       br i1 [[NOFL_TMP]], label %[[CONT:.*]], label %[[TRAP:.*]], !prof !3, !nosanitize !2
// CATCH_UB:       [[TRAP]]:
// CATCH_UB-NEXT:    @__ubsan_handle_invalid_builtin
// CATCH_UB-NEXT:    unreachable
// CATCH_UB:       [[CONT]]:
// CATCH_UB-NEXT:    [[ABSCOND:%.*]] = icmp slt i32 [[X]], 0
// CATCH_UB-NEXT:    select i1 [[ABSCOND]], i32 [[NEGV]], i32 [[X]]
//
  return __builtin_abs(x);
}
